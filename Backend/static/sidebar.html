<html>
  <head>
    <!-- Existing head content -->
    <script src="https://cdn.tailwindcss.com"></script>
    <style>
        /* Add chatbot styles */
        .chat-message {
            max-width: 80%;
            word-wrap: break-word;
        }
        .typing-indicator span {
            animation: blink 1s infinite;
        }
        .typing-indicator span:nth-child(2) {
            animation-delay: 0.2s;
        }
        .typing-indicator span:nth-child(3) {
            animation-delay: 0.4s;
        }
        @keyframes blink {
            0% { opacity: 0.2; }
            20% { opacity: 1; }
            100% { opacity: 0.2; }
        }
        .chat-container {
            transition: all 0.3s ease-in-out;
        }
        pre {
            white-space: pre-wrap;
            word-wrap: break-word;
        }
        code {
            background-color: #f0f0f0;
            padding: 2px 4px;
            border-radius: 4px;
        }
    </style>
</head>
<body>
  
<aside class="w-1/4 bg-white p-6 shadow-lg flex flex-col justify-between text-lg h-full w-full">
  <nav>
    <ul class="space-y-6 font-semibold text-gray-800 text-xl">
      
      <!-- Centered Blog Image with increased size -->
      <li>
        <div class="flex justify-center mb-6">
          <img src="blog.png" alt="Blog Icon" class="w-28 h-28" />
        </div>
      </li>

      <!-- Enlarged & aligned nav links -->
      <li>
        <a href="static/blog_generator.html" class="block px-4 py-2 rounded hover:text-blue-600 hover:bg-blue-50 transition duration-200">
          üìù Blogs
        </a>
      </li>
      <li>
        <a href="static/image_generator.html" class="block px-4 py-2 rounded hover:text-blue-600 hover:bg-blue-50 transition duration-200">
          üñºÔ∏è Images
        </a>
      </li>
      <li>
        <a href="static/video_generator.html" class="block px-4 py-2 rounded hover:text-blue-600 hover:bg-blue-50 transition duration-200">
          üé• Videos
        </a>
      </li>
      <li>
        <a href="static/meme_generator.html" class="block px-4 py-2 rounded hover:text-blue-600 hover:bg-blue-50 transition duration-200">
          üòÇ Memes
        </a>
      </li>
    </ul>
  </nav>

  <div class="mt-10">
    <p class="text-gray-900 font-bold text-xl mb-4">üîê API Keys</p>

    <label class="block text-sm font-medium text-gray-700 mb-1">Gemini API Key</label>
    <input type="password" class="w-full p-3 border border-gray-300 rounded-lg bg-gray-100 mb-4" placeholder="Enter Gemini API Key" />

    <label class="block text-sm font-medium text-gray-700 mb-1">HuggingFace API Key</label>
    <input type="password" class="w-full p-3 border border-gray-300 rounded-lg bg-gray-100" placeholder="Enter HuggingFace API Key" />
  </div>

</aside>
  <!-- Chat Button -->
<button id="chat-button" class="fixed bottom-6 right-6 bg-blue-600 text-white rounded-full w-14 h-14 flex items-center justify-center shadow-lg hover:bg-blue-700 focus:outline-none z-50">
  <svg xmlns="http://www.w3.org/2000/svg" class="h-6 w-6" fill="none" viewBox="0 0 24 24" stroke="currentColor">
      <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M8 10h.01M12 10h.01M16 10h.01M9 16H5a2 2 0 01-2-2V6a2 2 0 012-2h14a2 2 0 012 2v8a2 2 0 01-2 2h-5l-5 5v-5z" />
  </svg>
</button>

<!-- Chat Container -->
<div id="chat-container" class="chat-container fixed bottom-24 right-6 w-96 bg-white rounded-lg shadow-xl overflow-hidden z-50 hidden">
  <!-- Chat Header -->
  <div class="bg-blue-600 text-white px-4 py-3 flex justify-between items-center">
      <h3 class="font-medium">Chat with Your Code</h3>
      <button id="close-chat" class="focus:outline-none">
          <svg xmlns="http://www.w3.org/2000/svg" class="h-5 w-5" viewBox="0 0 20 20" fill="currentColor">
              <path fill-rule="evenodd" d="M4.293 4.293a1 1 0 011.414 0L10 8.586l4.293-4.293a1 1 0 111.414 1.414L11.414 10l4.293 4.293a1 1 0 01-1.414 1.414L10 11.414l-4.293 4.293a1 1 0 01-1.414-1.414L8.586 10 4.293 5.707a1 1 0 010-1.414z" clip-rule="evenodd" />
          </svg>
      </button>
  </div>
  
  <!-- Chat Messages -->
  <div id="chat-messages" class="p-4 h-96 overflow-y-auto bg-gray-50">
      <div class="flex items-start mb-4">
          <div class="bg-blue-100 text-gray-800 rounded-lg py-2 px-4 chat-message">
              Hi! I'm your code assistant. Ask me anything about the repository.
          </div>
      </div>
  </div>
  
  <!-- Chat Input -->
  <div class="border-t border-gray-200 p-4 bg-white">
      <div class="flex items-center">
          <input id="user-input" type="text" 
              placeholder="Ask about the code..." 
              class="flex-1 border border-gray-300 rounded-lg px-4 py-2 focus:outline-none focus:ring-2 focus:ring-blue-500"
              disabled>
          <button id="send-button" 
              class="ml-2 bg-blue-600 text-white rounded-lg px-4 py-2 hover:bg-blue-700 focus:outline-none disabled:opacity-50"
              disabled>
              <svg xmlns="http://www.w3.org/2000/svg" class="h-5 w-5" viewBox="0 0 20 20" fill="currentColor">
                  <path d="M10.894 2.553a1 1 0 00-1.788 0l-7 14a1 1 0 001.169 1.409l5-1.429A1 1 0 009 15.571V11a1 1 0 112 0v4.571a1 1 0 00.725.962l5 1.428a1 1 0 001.17-1.408l-7-14z" />
              </svg>
          </button>
      </div>
      <div id="status-message" class="text-xs text-gray-500 mt-2"></div>
  </div>
</div>



</body>
<script>

document.addEventListener('DOMContentLoaded', () => {
    const chatButton = document.getElementById('chat-button');
    const chatContainer = document.getElementById('chat-container');
    const closeChat = document.getElementById('close-chat');
    const userInput = document.getElementById('user-input');
    const sendButton = document.getElementById('send-button');
    const chatMessages = document.getElementById('chat-messages');
    const statusMessage = document.getElementById('status-message');
    // initializeKnowledgeBase();
    // Initialize chat
    initializeChat();
    checkInitialization();
    // Initialize chat functionality
    function initializeChat() {
        userInput.disabled = false;
        sendButton.disabled = false;
    }

    // Toggle chat visibility
    chatButton.addEventListener('click', () => {
        chatContainer.classList.toggle('hidden');
        if (!chatContainer.classList.contains('hidden')) {
            userInput.focus();
        }
    });

    closeChat.addEventListener('click', () => {
        chatContainer.classList.add('hidden');
    });

    function addMessageToChat(text, sender) {
        const messageDiv = document.createElement('div');
        messageDiv.className = `flex items-start mb-4 ${sender === 'user' ? 'justify-end' : ''}`;
        
        const messageContent = text.replace(/```([\s\S]*?)```/g, '<pre><code>$1</code></pre>');
        
        messageDiv.innerHTML = `
            <div class="${sender === 'user' ? 
                'bg-blue-500 text-white' : 
                'bg-blue-100 text-gray-800'} rounded-lg py-2 px-4 chat-message">
                ${messageContent}
            </div>
        `;
        
        chatMessages.appendChild(messageDiv);
        chatMessages.scrollTop = chatMessages.scrollHeight;
    }

    function sendMessage() {
        const message = userInput.value.trim();
        if (!message || userInput.disabled) return;
        
        addMessageToChat(message, 'user');
        userInput.value = '';
        userInput.disabled = true;
        sendButton.disabled = true;
        
        // Add typing indicator
        const typingDiv = document.createElement('div');
        typingDiv.className = 'flex items-start mb-4';
        typingDiv.innerHTML = `
            <div class="bg-blue-100 text-gray-800 rounded-lg py-2 px-4 chat-message typing-indicator">
                <span>.</span><span>.</span><span>.</span>
            </div>
        `;
        typingDiv.id = 'typing-indicator';
        chatMessages.appendChild(typingDiv);
        chatMessages.scrollTop = chatMessages.scrollHeight;
        
        // Send to server
        fetch('/api/chat', {
            method: 'POST',
            headers: { 'Content-Type': 'application/json' },
            body: JSON.stringify({ query: message })
        })
        .then(response => response.json())
        .then(data => {
            const indicator = document.getElementById('typing-indicator');
            if (indicator) indicator.remove();
            
            if (data.response) {
                addMessageToChat(data.response, 'bot');
            } else {
                addMessageToChat('Received empty response from server.', 'bot');
            }
        })
        .catch(error => {
            console.error('Error:', error);
            const indicator = document.getElementById('typing-indicator');
            if (indicator) indicator.remove();
            addMessageToChat('Sorry, there was an error processing your request.', 'bot');
        })
        .finally(() => {
            userInput.disabled = false;
            sendButton.disabled = false;
            userInput.focus();
        });
    }
    function updateStatusMessage(message, isError = false) {
    const statusMessage = document.getElementById('status-message');
    statusMessage.textContent = message;
    statusMessage.className = `text-xs ${isError ? 'text-red-500' : 'text-gray-500'} mt-2`;
}

// Modify the sendMessage function to include better error handling
function sendMessage() {
    const message = userInput.value.trim();
    if (!message) {
        updateStatusMessage('Please enter a message');
        return;
    }
    if (userInput.disabled) return;
    
    addMessageToChat(message, 'user');
    userInput.value = '';
    userInput.disabled = true;
    sendButton.disabled = true;
    
    const typingDiv = document.createElement('div');
    typingDiv.className = 'flex items-start mb-4';
    typingDiv.innerHTML = `
        <div class="bg-blue-100 text-gray-800 rounded-lg py-2 px-4 chat-message typing-indicator">
            <span>.</span><span>.</span><span>.</span>
        </div>
    `;
    typingDiv.id = 'typing-indicator';
    chatMessages.appendChild(typingDiv);
    chatMessages.scrollTop = chatMessages.scrollHeight;
    
    fetch('/api/chat', {
        method: 'POST',
        headers: { 'Content-Type': 'application/json' },
        body: JSON.stringify({ query: message })
    })
    .then(response => {
        if (!response.ok) {
            throw new Error(`HTTP error! status: ${response.status}`);
        }
        return response.json();
    })
    .then(data => {
        const indicator = document.getElementById('typing-indicator');
        if (indicator) indicator.remove();
        
        if (data.response) {
            addMessageToChat(data.response, 'bot');
            updateStatusMessage('');
        } else {
            throw new Error('Empty response from server');
        }
    })
    .catch(error => {
        console.error('Error:', error);
        const indicator = document.getElementById('typing-indicator');
        if (indicator) indicator.remove();
        addMessageToChat('Sorry, there was an error processing your request.', 'bot');
        updateStatusMessage(error.message, true);
    })
    .finally(() => {
        userInput.disabled = false;
        sendButton.disabled = false;
        userInput.focus();
    });
}
async function initializeKnowledgeBase() {
    try {
        const response = await fetch('/api/initialize', { method: 'POST' });
        const data = await response.json();
        if (data.success) {
            updateStatusMessage('Initializing knowledge base...');
            checkInitialization();
        } else {
            updateStatusMessage('Failed to initialize: ' + data.message, true);
        }
    } catch (error) {
        updateStatusMessage('Error initializing: ' + error.message, true);
    }
}
// Add initialization check
function checkInitialization() {
    fetch('/api/status')
        .then(response => response.json())
        .then(data => {
            if (data.initialized) {
                userInput.disabled = false;
                sendButton.disabled = false;
                updateStatusMessage('Chat is ready');
            } else if (data.status === 'failed') {
                updateStatusMessage('Initialization failed', true);
            } else {
                updateStatusMessage('Initializing chat...');
                setTimeout(checkInitialization, 2000);
            }
        })
        .catch(error => {
            console.error('Error checking status:', error);
            updateStatusMessage('Error checking status', true);
        });


    // Event listeners
    chatButton.addEventListener('click',initializeChat)
    sendButton.addEventListener('click', sendMessage);
    userInput.addEventListener('keypress', (e) => {
        if (e.key === 'Enter') sendMessage();
    });
    
}});
</script>
</html>